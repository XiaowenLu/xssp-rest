{% extends "base.html" %}

{% block content %}

<p class="lead">
  Select the output type and enter a protein sequence or PDB data into the box
  below, or select a file containing the sequence or PDB data.
</p>

{% from "form_macros.html" import render_form_errors %}

{{ render_form_errors(form) }}

<form method="post" action="{{ url_for('dashboard.index') }}" role="form"
      enctype="multipart/form-data">
  {{ form.hidden_tag() }}

  <div class="form-group">
    {{ form.type_(class_='form-control') }}
  </div>

  <div class="form-group">
    {{ form.data(class_='form-control', rows="20") }}
  </div>
  <div class="form-group">
    <div class="input-group">
      <span class="input-group-btn">
        <span class="btn btn-primary btn-file">
          Browse&hellip; {{ form.file_(class='form-control') }}
        </span>
      </span>
      <input type="text" class="form-control" disabled>
    </div>
  </div>
  <hr/>
  <div class="form-group pull-right">
    <button type="reset" class="btn btn-default">Clear</button>
    <button type="submit" class="btn btn-success">Submit</button>
  </div>
</form>

{% endblock %}

{% block js %}

<script type="text/javascript">
  $(document).on('change', '.btn-file :file', function() {
    var input = $(this),
        numFiles = input.get(0).files ? input.get(0).files.length : 1,
        label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
    input.trigger('fileselect', [numFiles, label]);
  });

  $(document).ready( function() {
    $('.btn-file :file').on('fileselect', function(event, numFiles, label) {
          var input = $(this).parents('.input-group').find(':text'),
              log = numFiles > 1 ? numFiles + ' files selected' : label;

          if( input.length ) {
              input.val(log);
          } else {
              if( log ) alert(log);
          }
      });
  });
</script>

{% endblock %}
